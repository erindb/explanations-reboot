var utility = function(item, items, utilityCoefs) {
	var dimensions = _.keys(utilityCoefs);
	return sum(map(function(dim) {
		return utilityCoefs[dim] * items[item][dim];
	}, dimensions));
};

var actionPosterior = function(items, utilityCoefs, rationality, infer) {
	return infer(function() {
		var item = uniformDraw(_.keys(items));
		factor(rationality * utility(item, items, utilityCoefs));
		return item;
	});
};

var decision = function(items, utilityCoefs, rationality, infer) {
	return sample(actionPosterior(items, utilityCoefs, rationality, infer));
};

var agent = function() {
	// t is a time marker for if things change over time
	// currently, they don't

	var items = {
		money: {prettiness: 0, yumminess: 0},
		brownies: {prettiness: 0, yumminess: 1},
		flowers: {prettiness: 1, yumminess: 0},
		cupcakes: {prettiness: 1, yumminess: 1},
	};

	var utilityCoefs = {prettiness: 1, yumminess: 1};

	var rationality = 1;

	var infer = function(fn) {
		return Infer({method: "enumerate"}, fn);
	};

	var action = decision(items, utilityCoefs, rationality, infer);

	return {
		'items["cupcakes"]["prettiness"]': items["cupcakes"]["prettiness"],
		'items["cupcakes"]["yumminess"]': items["cupcakes"]["yumminess"],
		'items["flowers"]["prettiness"]': items["flowers"]["prettiness"],
		'items["flowers"]["yumminess"]': items["flowers"]["yumminess"],
		'items["brownies"]["prettiness"]': items["brownies"]["prettiness"],
		'items["brownies"]["yumminess"]': items["brownies"]["yumminess"],
		'items["money"]["prettiness"]': items["money"]["prettiness"],
		'items["money"]["yumminess"]': items["money"]["yumminess"],
		'utilityCoefs["prettiness"]': utilityCoefs["prettiness"],
		'utilityCoefs["yumminess"]': utilityCoefs["yumminess"],
		'rationality': rationality,
		'action': action
	};
};

agent();